<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>InterIUT - ESPionnage | Wanako Blog</title><meta name=keywords content="Hardware,Reseau,Reverse"><meta name=description content="Write Up du challenge ESPionnage du CTF InterIUT 2025"><meta name=author content="Wanako Kanan"><link rel=canonical href=http://localhost:1313/posts/espionnage/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/img/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/img/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/img/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/img/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/img/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/espionnage/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/espionnage/"><meta property="og:site_name" content="Wanako Blog"><meta property="og:title" content="InterIUT - ESPionnage"><meta property="og:description" content="Write Up du challenge ESPionnage du CTF InterIUT 2025"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-28T16:25:48+02:00"><meta property="article:modified_time" content="2025-05-28T16:25:48+02:00"><meta property="article:tag" content="Hardware"><meta property="article:tag" content="Reseau"><meta property="article:tag" content="Reverse"><meta property="og:image" content="http://localhost:1313/images/avatar.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/images/avatar.jpg"><meta name=twitter:title content="InterIUT - ESPionnage"><meta name=twitter:description content="Write Up du challenge ESPionnage du CTF InterIUT 2025"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"InterIUT - ESPionnage","item":"http://localhost:1313/posts/espionnage/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"InterIUT - ESPionnage","name":"InterIUT - ESPionnage","description":"Write Up du challenge ESPionnage du CTF InterIUT 2025","keywords":["Hardware","Reseau","Reverse"],"articleBody":"Voici un Write Up des challenges ESPionnage réaliser par Philippe_Katerine dans le cadre du ctf interiut 2025.\nCatégorie: Hardware\nEnnoncer Partie 1 Ce challenge se déroule en trois étapes. Le but final étant d’accéder au contenu d’un coffre-fort connecté situé sur la table des Admins. Chaque étape se débloque en résolvant la précédente.\nPour cette première phase, vous interceptez une transmission sur le réseau sans fil de la secte CASTEM lors de l’OTA du coffre. Une capture réseau de cette transmission ainsi qu’une documentation sur le coffre sont à télécharger. À vous de l’analyser pour récupérer le firmware embarqué du système de verrouillage.\nLe flag de ce premier challenge est le hash sha256 du binaire.\nExemple de flag : interiut{sha256(firmware.bin)}\nFichier disponible : ota.pcapng et doc.pdf\nRésolution Partie 1 Analyse du document Le document présente le contexte ainsi que les différents équipements avec lesquels nous interagirons.\nAnalyse de la capture réseaux La capture réseau est courte, ça nous permet de nous concentrer sur beaucoup d’element.\nRésumer des informations importante :\nLes quetes DNS pointent vers eddymalou.fr -\u003e 45.147.99.180. 2 Requete GET sur eddymalou.fr/firmware.elf Une rejecter car non connecter (mauvais cookie) Une autre autorisé Pas de possibilité de récuperer le firmware telechargé Différent message avec le protocole MQTT Résolution Dans le but d’avoir nous aussi accès au firmware, nous devons generer un bon cookie utilisable sur le site. Via la capture, nous comprennons que nous devrons utiliser le protocole MQTT pour réussir à avoir un cookie valable.\nMQTT ? Le protocole MQTT (Message Queuing Telemetry Transport) est un protocole de messagerie léger basé sur le modèle publish/subscribe. Il est conçu pour permettre la communication entre des appareils sur des réseaux à faible bande passante ou peu fiables, comme dans les systèmes IoT. Un broker central reçoit les messages publiés sur des “topics” par des clients (publishers) et les distribue aux clients abonnés (subscribers). Dans notre cas le serveur sera le même que celui utiliser dans capture soit 45.147.99.180. Celui nous renverra un token utilisable ensuite sur le site internet.\nEn ce qui concerne les login et password on peut les voir dans la trame 5.\nMaintenant que c’est tout bon, c’est parti !\nVoici un packet permettant de faire des requetes MQTT.\nsudo apt install mosquitto-clients mosquitto_sub -h 45.147.99.180 -p 1883 -u \"iotcastem\" -P \"tungtungsahur\" -t \"#\" Rapide explication\n-h hote à interroger -p port -u utilisateur -P mot de passe -t topic (# = tout les topics, on pourrait mettre /auth_token) Et tout fonctionne bien, on utilise le cookie reçu pour recuperer le firmware sur la page.\n(Je suis passé par une extension dans le nagivateur pour modifier le cookie) Pour finir pour avoir le flag, on mets simplement au format.\nsha256sum firmware.elf 23b5141d81e852b5683ddf10a8e8036dd20c5675b4547d4ba44e4407343e50d1 firmware.elf Flag : interiut{23b5141d81e852b5683ddf10a8e8036dd20c5675b4547d4ba44e4407343e50d1}\nEnnoncer Partie 2 Vous avez mis la main sur le firmware du coffre-fort, bravo! CASTEM pensait sa technologie inviolable… mais c’est à vous de prouver le contraire.\nDans cette deuxième phase, vous devrez analyser le binaire extrait et comprendre le fonctionnement interne du système de verrouillage. L’objectif est d’identifier la bonne valeur de la carte autorisée à ouvrir le coffre.\nLe firmware a été compilé pour une carte ESP32, et contient tout le code nécessaire à la gestion du lecteur NFC et de l’interface graphique.\nLe flag de ce challenge est la string décodée hexa -\u003e ascii de la bonne valeur qui ouvre le coffre.\nExemple de flag : interiut{string_ascii}\nRésolution Partie 2 Fonctionnement du firmware CASTEM LOCK L’analyse statique du firmware a été réalisée à l’aide de Ghidra, afin de comprendre le comportement du programme embarqué sur l’ESP32.\nLe firmware tourne sur un ESP32 et utilise un module NFC PN532 pour lire des cartes MIFARE Classic. Son rôle est de vérifier si une carte présentée est valide pour déverrouiller un cadenas.\nLa logique principale est contenue dans la fonction loop(), qui s’exécute en permanence. Toutes les 500 millisecondes, le système vérifie si une carte est détectée. Si c’est le cas :\nIl lit l’UID de la carte et l’affiche. Il tente d’authentifier le bloc 4 (premier bloc du secteur 1) avec une clé par défaut.\nuVar3 = PN532::mifareclassic_AuthenticateBlock(\u0026nfc, uid, uidLength, 4, '\\0', defaultMifareKey); Si l’authentification réussit, il lit les données du bloc 4.\nPN532::mifareclassic_ReadDataBlock(\u0026nfc,'\\x04',data); Il compare ces données avec une valeur attendue (expectedMifareData). iVar6 = memcmp(data,expectedMifareData,8); if (iVar6 == 0) { Print::println((Print *)\u0026Serial0,s_Access_granted_!_sector_1_matche_3f4001f1); status = s_Lock_status:_Access_granted!_3f400228; bVar2 = true; } else { Print::println((Print *)\u0026Serial0,s_Access_denied_!_sector_1_doesn't_3f400245); status = s_Lock_status:_Access_denied_3f400282; bVar2 = false; } Si les données correspondent, l’accès est accordé et un code de déverrouillage s’affiche à l’écran ; sinon, l’accès est refusé. Le firmware met aussi à jour un statut d’accès pour informer l’utilisateur visuellement du résultat.\nRécuper la valeur de expectedMifareData Pour extraire la valeur de expectedMifareData dans Ghidra, il suffit d’utiliser la recherche de chaînes intégrée. Accédez à : Search → For Strings dans la barre de menu.\nUne fois les chaînes affichées, vous pouvez repérer facilement la valeur attendue comparée par memcmp. Dans ce cas, il s’agit de la chaîne rickroll.\nFlag : interiut{rickroll}\nEnnoncer Partie 3 Vous avez désormais en main la valeur autorisée par le firmware du coffre-fort. Mais posséder la connaissance ne suffit pas… il vous faut maintenant agir, comme le ferait un véritable initié de la secte.\nChaque équipe a reçu une carte NFC. À vous de trouver une moyen d’ouvrir le coffre sans se faire prendre par les gardes!\nLe coffre se trouve sur la table des admins, et le flag final se trouve à l’intérieur du coffre.\nRésolution Partie 3 Pour la partie 3 nous allons donc devoir modifier une carte NFC qui nous a été fournie dans le but d’ouvrir le coffre.\nPour ce faire nous utilisons l’application mifare classic tool. Lancer l’application et choisir lire Tag Depuis le menu principal de l’app, choisissez l’option “Lire Tag”.\nUne fois détectée, l’application affiche tous les secteurs de la carte.\nTous sont vides sauf le secteur 0, qui contient l’UID (normal, c’est un secteur non modifiable).\nLe firmware attend une valeur spécifique dans le secteur 1, bloc 4. Grâce à l’analyse faite dans la partie précédente, nous savons que la valeur attendue est la chaîne : rickroll\nOn l’écrit donc en hexadécimal dans le secteur 1 via l’interface de l’application :\nUne fois les données modifiées, ouvrez le menu … en haut à droite, puis sélectionnez “Write Dump”.\nL’application va alors écrire les données modifiées sur la carte NFC.\nEn posant cette carte sur le coffre-fort des admins, le système reconnaît la chaîne “rickroll” comme valide, et le coffre se déverrouille.\nVous récupérez ainsi le flag final du challenge.\n","wordCount":"1095","inLanguage":"en","image":"http://localhost:1313/images/avatar.jpg","datePublished":"2025-05-28T16:25:48+02:00","dateModified":"2025-05-28T16:25:48+02:00","author":{"@type":"Person","name":"Wanako Kanan"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/espionnage/"},"publisher":{"@type":"Organization","name":"Wanako Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/img/favicon-32x32.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Wanako Blog (Alt + H)"><img src=http://localhost:1313/images/avatar.jpg alt aria-label=logo height=35>Wanako Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/posts/ title=Blog><span>Blog</span></a></li><li><a href=http://localhost:1313/projets/ title=Projets><span>Projets</span></a></li><li><a href=http://localhost:1313/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">InterIUT - ESPionnage</h1><div class=post-description>Write Up du challenge ESPionnage du CTF InterIUT 2025</div><div class=post-meta><span title='2025-05-28 16:25:48 +0200 CEST'>28 May 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1095 words&nbsp;·&nbsp;Wanako Kanan</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ennoncer-partie-1>Ennoncer Partie 1</a></li><li><a href=#résolution-partie-1>Résolution Partie 1</a><ul><li><a href=#analyse-du-document>Analyse du document</a></li><li><a href=#analyse-de-la-capture-réseaux>Analyse de la capture réseaux</a></li><li><a href=#résolution>Résolution</a></li></ul></li><li><a href=#ennoncer-partie-2>Ennoncer Partie 2</a></li><li><a href=#résolution-partie-2>Résolution Partie 2</a><ul><li><a href=#fonctionnement-du-firmware-castem-lock>Fonctionnement du firmware CASTEM LOCK</a></li><li><a href=#récuper-la-valeur-de-expectedmifaredata>Récuper la valeur de <code>expectedMifareData</code></a></li></ul></li><li><a href=#ennoncer-partie-3>Ennoncer Partie 3</a></li><li><a href=#résolution-partie-3>Résolution Partie 3</a></li></ul></nav></div></details></div><div class=post-content><p>Voici un Write Up des challenges <code>ESPionnage</code> réaliser par Philippe_Katerine dans le cadre du ctf <code>interiut 2025</code>.<br>Catégorie: Hardware</p><hr><h2 id=ennoncer-partie-1>Ennoncer Partie 1<a hidden class=anchor aria-hidden=true href=#ennoncer-partie-1>#</a></h2><p>Ce challenge se déroule en trois étapes. Le but final étant d’accéder au contenu d&rsquo;un coffre-fort connecté situé sur la table des Admins. Chaque étape se débloque en résolvant la précédente.</p><p>Pour cette première phase, vous interceptez une transmission sur le réseau sans fil de la secte CASTEM lors de l&rsquo;OTA du coffre. Une capture réseau de cette transmission ainsi qu&rsquo;une documentation sur le coffre sont à télécharger. À vous de l’analyser pour récupérer le firmware embarqué du système de verrouillage.</p><p>Le flag de ce premier challenge est le hash sha256 du binaire.</p><p>Exemple de flag : interiut{sha256(firmware.bin)}</p><p>Fichier disponible : ota.pcapng et doc.pdf</p><hr><h2 id=résolution-partie-1>Résolution Partie 1<a hidden class=anchor aria-hidden=true href=#résolution-partie-1>#</a></h2><h3 id=analyse-du-document>Analyse du document<a hidden class=anchor aria-hidden=true href=#analyse-du-document>#</a></h3><p>Le document présente le contexte ainsi que les différents équipements avec lesquels nous interagirons.</p><h3 id=analyse-de-la-capture-réseaux>Analyse de la capture réseaux<a hidden class=anchor aria-hidden=true href=#analyse-de-la-capture-réseaux>#</a></h3><p>La capture réseau est courte, ça nous permet de nous concentrer sur beaucoup d&rsquo;element.<br><img alt="capture reseaux image" loading=lazy src=/posts/espionnage/ota_capture.png></p><p>Résumer des informations importante :</p><ul><li>Les quetes DNS pointent vers <code>eddymalou.fr</code> -> <code>45.147.99.180</code>.</li><li>2 Requete GET sur <code>eddymalou.fr/firmware.elf</code><ul><li>Une rejecter car non connecter (mauvais cookie)</li><li>Une autre autorisé</li><li>Pas de possibilité de récuperer le firmware telechargé</li></ul></li><li>Différent message avec le protocole MQTT</li></ul><h3 id=résolution>Résolution<a hidden class=anchor aria-hidden=true href=#résolution>#</a></h3><p>Dans le but d&rsquo;avoir nous aussi accès au firmware, nous devons generer un bon cookie utilisable sur le site.
Via la capture, nous comprennons que nous devrons utiliser le protocole MQTT pour réussir à avoir un cookie valable.</p><h5 id=mqtt->MQTT ?<a hidden class=anchor aria-hidden=true href=#mqtt->#</a></h5><p>Le protocole <strong>MQTT</strong> (Message Queuing Telemetry Transport) est un protocole de messagerie léger basé sur le modèle publish/subscribe. Il est conçu pour permettre la communication entre des appareils sur des réseaux à faible bande passante ou peu fiables, comme dans les systèmes IoT. Un broker central reçoit les messages publiés sur des &ldquo;topics&rdquo; par des clients (publishers) et les distribue aux clients abonnés (subscribers).
Dans notre cas le serveur sera le même que celui utiliser dans capture soit <code>45.147.99.180</code>. Celui nous renverra un token utilisable ensuite sur le site internet.</p><p><img alt=mqtt_detail1 loading=lazy src=/posts/espionnage/mqtt_description1.png>
<img alt=mqtt_detail2 loading=lazy src=/posts/espionnage/mqtt_description2.png></p><p>En ce qui concerne les login et password on peut les voir dans la trame 5.</p><p><img alt=information_connnextion loading=lazy src=/posts/espionnage/mqtt_conn.png></p><p>Maintenant que c&rsquo;est tout bon, c&rsquo;est parti !<br>Voici un packet permettant de faire des requetes MQTT.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install mosquitto-clients
</span></span><span class=line><span class=cl>mosquitto_sub -h 45.147.99.180 -p <span class=m>1883</span> -u <span class=s2>&#34;iotcastem&#34;</span> -P <span class=s2>&#34;tungtungsahur&#34;</span> -t <span class=s2>&#34;#&#34;</span>
</span></span></code></pre></div><p>Rapide explication</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>-h hote à interroger
</span></span><span class=line><span class=cl>-p port
</span></span><span class=line><span class=cl>-u utilisateur
</span></span><span class=line><span class=cl>-P mot de passe
</span></span><span class=line><span class=cl>-t topic (# = tout les topics, on pourrait mettre /auth_token)
</span></span></code></pre></div><p><img alt="Commande mosquitto" loading=lazy src=/posts/espionnage/commande_mosquitto.png>
Et tout fonctionne bien, on utilise le cookie reçu pour recuperer le firmware sur la page.</p><p>(Je suis passé par une extension dans le nagivateur pour modifier le cookie)
<img alt="Cookie modification" loading=lazy src=/posts/espionnage/cookie_modification.png></p><p>Pour finir pour avoir le flag, on mets simplement au format.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sha256sum firmware.elf
</span></span><span class=line><span class=cl>23b5141d81e852b5683ddf10a8e8036dd20c5675b4547d4ba44e4407343e50d1  firmware.elf
</span></span></code></pre></div><p>Flag : <code>interiut{23b5141d81e852b5683ddf10a8e8036dd20c5675b4547d4ba44e4407343e50d1}</code></p><hr><h2 id=ennoncer-partie-2>Ennoncer Partie 2<a hidden class=anchor aria-hidden=true href=#ennoncer-partie-2>#</a></h2><p>Vous avez mis la main sur le firmware du coffre-fort, bravo! CASTEM pensait sa technologie inviolable&mldr; mais c’est à vous de prouver le contraire.</p><p>Dans cette deuxième phase, vous devrez analyser le binaire extrait et comprendre le fonctionnement interne du système de verrouillage. L’objectif est d’identifier la bonne valeur de la carte autorisée à ouvrir le coffre.</p><p>Le firmware a été compilé pour une carte ESP32, et contient tout le code nécessaire à la gestion du lecteur NFC et de l’interface graphique.</p><p>Le flag de ce challenge est la string décodée hexa -> ascii de la bonne valeur qui ouvre le coffre.</p><p>Exemple de flag : interiut{string_ascii}</p><h2 id=résolution-partie-2>Résolution Partie 2<a hidden class=anchor aria-hidden=true href=#résolution-partie-2>#</a></h2><h3 id=fonctionnement-du-firmware-castem-lock>Fonctionnement du firmware CASTEM LOCK<a hidden class=anchor aria-hidden=true href=#fonctionnement-du-firmware-castem-lock>#</a></h3><p>L’analyse statique du firmware a été réalisée à l’aide de Ghidra, afin de comprendre le comportement du programme embarqué sur l’ESP32.</p><p>Le firmware tourne sur un <strong>ESP32</strong> et utilise un module <strong>NFC PN532</strong> pour lire des cartes <strong>MIFARE Classic</strong>. Son rôle est de vérifier si une carte présentée est valide pour déverrouiller un cadenas.</p><p>La logique principale est contenue dans la fonction <code>loop()</code>, qui s&rsquo;exécute en permanence. Toutes les 500 millisecondes, le système vérifie si une carte est détectée. Si c’est le cas :</p><ol><li>Il lit l’<strong>UID</strong> de la carte et l’affiche.</li><li>Il tente d’<strong>authentifier le bloc 4</strong> (premier bloc du <strong>secteur 1</strong>) avec une clé par défaut.<br><code>uVar3 = PN532::mifareclassic_AuthenticateBlock(&amp;nfc, uid, uidLength, 4, '\0', defaultMifareKey);</code></li><li>Si l’authentification réussit, il lit les <strong>données du bloc 4</strong>.<br><code>PN532::mifareclassic_ReadDataBlock(&amp;nfc,'\x04',data);</code></li><li>Il compare ces données avec une <strong>valeur attendue</strong> (<code>expectedMifareData</code>).</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>iVar6</span> <span class=o>=</span> <span class=nf>memcmp</span><span class=p>(</span><span class=n>data</span><span class=p>,</span><span class=n>expectedMifareData</span><span class=p>,</span><span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>iVar6</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Print</span><span class=o>::</span><span class=nf>println</span><span class=p>((</span><span class=n>Print</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>Serial0</span><span class=p>,</span><span class=n>s_Access_granted_</span><span class=o>!</span><span class=n>_sector_1_matche_3f4001f1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>status</span> <span class=o>=</span> <span class=nl>s_Lock_status</span><span class=p>:</span><span class=n>_Access_granted</span><span class=o>!</span><span class=n>_3f400228</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>bVar2</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Print</span><span class=o>::</span><span class=nf>println</span><span class=p>((</span><span class=n>Print</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>Serial0</span><span class=p>,</span><span class=n>s_Access_denied_</span><span class=o>!</span><span class=n>_sector_1_doesn</span><span class=err>&#39;</span><span class=n>t_3f400245</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>status</span> <span class=o>=</span> <span class=nl>s_Lock_status</span><span class=p>:</span><span class=n>_Access_denied_3f400282</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>bVar2</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol start=5><li>Si les données correspondent, l&rsquo;accès est accordé et un <strong>code de déverrouillage s&rsquo;affiche</strong> à l&rsquo;écran ; sinon, l&rsquo;accès est refusé.</li></ol><p>Le firmware met aussi à jour un <strong>statut d’accès</strong> pour informer l’utilisateur visuellement du résultat.</p><h3 id=récuper-la-valeur-de-expectedmifaredata>Récuper la valeur de <code>expectedMifareData</code><a hidden class=anchor aria-hidden=true href=#récuper-la-valeur-de-expectedmifaredata>#</a></h3><p>Pour extraire la valeur de <code>expectedMifareData</code> dans Ghidra, il suffit d’utiliser la recherche de chaînes intégrée.
Accédez à : <strong><code>Search</code> → <code>For Strings</code></strong> dans la barre de menu.</p><p>Une fois les chaînes affichées, vous pouvez repérer facilement la <strong>valeur attendue</strong> comparée par <code>memcmp</code>.
Dans ce cas, il s’agit de la chaîne <strong><code>rickroll</code></strong>.</p><p><img alt="search for string" loading=lazy src=/posts/espionnage/search_for_string.png></p><p>Flag : <code>interiut{rickroll}</code></p><hr><h2 id=ennoncer-partie-3>Ennoncer Partie 3<a hidden class=anchor aria-hidden=true href=#ennoncer-partie-3>#</a></h2><p>Vous avez désormais en main la valeur autorisée par le firmware du coffre-fort. Mais posséder la connaissance ne suffit pas… il vous faut maintenant agir, comme le ferait un véritable initié de la secte.</p><p>Chaque équipe a reçu une carte NFC. À vous de trouver une moyen d&rsquo;ouvrir le coffre sans se faire prendre par les gardes!</p><p>Le coffre se trouve sur la table des admins, et le flag final se trouve à l’intérieur du coffre.</p><h2 id=résolution-partie-3>Résolution Partie 3<a hidden class=anchor aria-hidden=true href=#résolution-partie-3>#</a></h2><p>Pour la partie 3 nous allons donc devoir modifier une carte NFC qui nous a été fournie dans le but d&rsquo;ouvrir le coffre.</p><p>Pour ce faire nous utilisons l&rsquo;application <code>mifare classic tool</code>.
Lancer l’application et choisir lire Tag
Depuis le menu principal de l&rsquo;app, choisissez l&rsquo;option &ldquo;Lire Tag”.</p><p><img alt="Mifare Tool Menu" loading=lazy src=/posts/espionnage/mifaretoolmenu.png>
Une fois détectée, l&rsquo;application affiche tous les secteurs de la carte.<br>Tous sont vides sauf le secteur 0, qui contient l’UID (normal, c’est un secteur non modifiable).</p><p><img alt="Secteur Vide" loading=lazy src=/posts/espionnage/Secteur_vide.png></p><p>Le firmware attend une valeur spécifique dans le secteur 1, bloc 4.
Grâce à l’analyse faite dans la partie précédente, nous savons que la valeur attendue est la chaîne : <code>rickroll</code><br>On l’écrit donc en hexadécimal dans le secteur 1 via l’interface de l’application :</p><p><img alt="Secteur 1 modifier" loading=lazy src=/posts/espionnage/secteur1.png></p><p>Une fois les données modifiées, ouvrez le menu &mldr; en haut à droite, puis sélectionnez “Write Dump”.<br>L’application va alors écrire les données modifiées sur la carte NFC.</p><p><img alt="Ecrire dump" loading=lazy src=/posts/espionnage/ecrire_dump.png></p><p>En posant cette carte sur le coffre-fort des admins, le système reconnaît la chaîne &ldquo;rickroll&rdquo; comme valide, et le coffre se déverrouille.</p><p>Vous récupérez ainsi le flag final du challenge.</p><p><img alt="alt text" loading=lazy src=/posts/espionnage/secte_castem.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/hardware/>Hardware</a></li><li><a href=http://localhost:1313/tags/reseau/>Reseau</a></li><li><a href=http://localhost:1313/tags/reverse/>Reverse</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Wanako Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>